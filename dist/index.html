<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <!-- 页面的元信息 -->
    <title>{TAG_14226_TAG}</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=1200, user-scalable=yes"/>
    <meta name="format-detection" content="telephone=no, email=no"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="white"/>
    <meta name="renderer" content="webkit"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="filetype" content="1"/>
    <meta name="publishedtype" content="1"/>
    <meta name="pagetype" content="2"/>
    
      <!-- 页面主样式文件 -->
      <link charset="utf-8"  rel="stylesheet" href="./static/css/owo.core.css">
      
    <!-- 附属css文件 -->
    <link rel="stylesheet" href="./static/css/main.css" charset="utf-8">
    <link rel="stylesheet" href="https://cunchu.site/owo/style/idangerous.swiper.css" charset="utf-8">
      
  </head>
  <body>
    
    <!-- 页面[login]-->
    <div class="login page" template="login" style="display: none;"><div class="login-title-bar"><img class="back" src="https://cunchu.site/puge/login/back.png" o-tap="toLogin"><div class="register" o-tap="toRegister">注册</div></div><div class="router" view="loginContent"><div class="view-login" route="login"><div class="image-box"><img src="https://cunchu.site/puge/login/image-box.png"></div><div class="user-name-bar input-bar"><img class="bar-icon" src="https://cunchu.site/puge/login/user.png"><input type="number" o-value="this.data.userPhone" placeholder="手机号"></div><div class="pass-word-bar input-bar"><img class="bar-icon" src="https://cunchu.site/puge/login/password.png"><input type="password" o-value="this.data.passWord" placeholder="密码"></div><div class="button" o-tap="login" o-hover="radial-out">登录</div><div class="tool-bar"><div class="left"></div><div class="right" o-tap="toForgetPassword">忘记密码</div></div><div class="weixin-login outher-login"><img o-tap="weixinLoginUrl" src="https://cunchu.site/puge/login/weixin.png"><p>微信登陆</p></div></div><div class="view-login" route="forgetPassword"><p class="title">找回密码</p><div class="phone-number-box"><input class="register-input phone-number" type="text" o-value="this.data.registerPhone" placeholder="手机号码"><button class="captcha-button" data-appid="2002224224" data-cbfn="callback" type="button">发送验证码</button></div><input class="register-input" type="text" o-value="this.data.phoneCode" placeholder="验证码"><input class="register-input" type="password" o-value="this.data.forgetPassWord" placeholder="新密码"><input class="register-input" type="password" o-value="this.data.forgetPassWordR" placeholder="重复新密码"><div class="button" o-tap="forget">重置密码</div></div><div class="view-register" route="register"><img class="bg-1" src="https://cunchu.site/puge/login/art.png"><input class="register-input" type="text" o-value="this.data.registerUserName" placeholder="用户昵称"><input class="register-input" type="password" o-value="this.data.registerPassWord" placeholder="密码"><input class="register-input" type="password" o-value="this.data.registerPassWordR" placeholder="确认密码"><div class="phone-number-box"><input class="register-input phone-number" type="text" o-value="this.data.registerPhone" placeholder="手机号码"><button class="captcha-button" data-appid="2002224224" data-cbfn="callback" type="button">发送验证码</button></div><input class="register-input" type="text" o-value="this.data.phoneCode" placeholder="手机验证码"><div class="user-info">注册即代表您已阅读并同意<a href="registerInfo.html">用户协议</a></div><div class="button" o-tap="register">注册</div></div></div></div>
    <!-- 页面[page]-->
    <div class="home page" template="page" style="display: none;"><div class="left"><div class="menu-item" go="/view-content=room">房间管理</div></div><div class="router" view="content"><div class="room router-item" route="room"><table><tbody><tr><th>房间ID</th><th>房间名</th><th>开始日期</th><th>打卡时间</th><th>创建人</th><th>房间状态</th></tr><tr o-for="this.data.info"><td>{value.id}</td><td>{value.name}</td><td>{value.start_day}</td><td>{value.daka_time}</td><td>{value.userName}</td><td>{value.finish}</td></tr></tbody></table></div></div></div>
    

    <script src="https://cunchu.site/owo/script/jquery-1.11.1.min.js" type="text/javascript"  charset="UTF-8"></script>
    <script src="https://cunchu.site/owo/script/idangerous.swiper.min.js" type="text/javascript"  charset="UTF-8"></script>
    <script src="./static/js/main.js" type="text/javascript"  charset="UTF-8"></script>
<!-- 框架script文件 -->
<script src="./static/js/owo.core.js" type="text/javascript" charset="UTF-8"></script>
<script type="text/javascript" charset="UTF-8">
// 模块 login 的script代码
window.callback = function (res) {
  var phone = owo.script.login.data.registerPhone;

  if (!phone || phone == '') {
    owo.tool.toast('没有填写手机号码!');
    return;
  }

  if (phone.length !== 11) {
    owo.tool.toast('手机号码不正确!');
    return;
  } // res（用户主动关闭验证码）= {ret: 2, ticket: null}
  // res（验证成功） = {ret: 0, ticket: "String", randstr: "String"}


  if (res.ret === 0) {
    console.log('请求发送验证码!');
    getData("/sendSms?ticket=" + res.ticket + "&phone=" + phone + "&randstr=" + res.randstr, function (data) {
      owo.tool.toast('验证码发送成功!');
    });
  }
};

owo.script = {
  "login": {
    "data": {
      "userPhone": "",
      "passWord": "",
      "registerUserName": "",
      "registerPassWord": "",
      "registerPassWordR": "",
      "registerPhone": "",
      "phoneCode": "",
      "forgetPassWord": "",
      "forgetPassWordR": ""
    },
    "created": function created() {
      var _this = this;

      setTimeout(function () {
        var loginContent = owo.state.urlVariable["view-loginContent"];

        if (loginContent != 'login' && loginContent !== undefined) {
          _this.query('.register').style.opacity = '0';
          _this.query('.back').style.opacity = '1';
        } else {
          _this.query('.register').style.opacity = '1';
          _this.query('.back').style.opacity = '0';
        }
      }, 0); // 注册腾讯验证按钮
      // this.queryAll('.captcha-button').forEach(element => {
      //   new TencentCaptcha(element)
      // })
    },
    "encry": function encry(text) {
      text = text.replace('e', 'k');
      text = text.replace('b', 'a');
      text = text.replace('q', 'aw');
      text = text.replace('3', '1');
      text = text.replace('12', '21');
      text = text.replace('6', '4');
      text = text.replace('k', '2');
      text = text.replace('w', 'n');
      text = text.replace('o', 'e');
      return text;
    },
    "login": function login() {
      // 计算md5
      var password = this.encry(this.data.passWord);

      if (!this.data.userPhone) {
        owo.tool.toast('手机号不能为空!');
        return;
      }

      if (!password) {
        if (owo.tool.toast) owo.tool.toast('密码不能为空!');else alert('密码不能为空!');
        return;
      }

      fetch(serverIP + "/login?phone=" + this.data.userPhone + "&password=" + password + "&type=supervisor").then(function (response) {
        return response.json();
      }).then(function (res) {
        if (res.err === 0) {
          if (owo.tool.toast) owo.tool.toast('登陆成功');else alert('登陆成功'); // do something
          // 保存token

          window.userInfo = res.data;
          setTimeout(function () {
            owo.go('page/');
          }, 0);
        } else {
          if (owo.tool.toast) owo.tool.toast(res.message);else alert(res.message);
        }
      });
    },
    "register": function register() {
      var _this2 = this;

      if (!this.data.registerUserName) {
        if (owo.tool.toast) owo.tool.toast('用户名不能为空哦!');else alert('用户名不能为空哦!');
        return;
      }

      if (!this.data.registerPassWord) {
        owo.tool.toast('密码不能为空哦!');
        return;
      }

      if (!this.data.registerPassWordR) {
        owo.tool.toast('重复密码不能为空哦!');
        return;
      }

      if (!this.data.phoneCode) {
        owo.tool.toast('手机验证码不能为空哦!');
        return;
      }

      if (this.data.registerPassWord !== this.data.registerPassWordR) {
        owo.tool.toast('两次输入的密码不一致哦!');
        return;
      }

      var password = this.encry(this.data.registerPassWord); // 获取是否被邀请的信息

      var variable = _owo.getQueryVariable();

      getData("/register?username=" + this.data.registerUserName + "&password=" + password + "&phone=" + this.data.registerPhone + "&phoneCode=" + this.data.phoneCode + "&inviter=" + variable.inviter, function (data) {
        owo.tool.toast('注册成功!');

        _this2.toLogin();
      });
    },
    "toRegister": function toRegister() {
      // go="/view-loginContent=register/moveToLeft/moveFromRight/true/moveToRight/moveFromLeft"
      this.query('.register').style.opacity = '0';
      this.query('.back').style.opacity = '1';
      owo.go('/view-loginContent=register/moveToLeft/moveFromRight/true/moveToRight/moveFromLeft');
    },
    "toLogin": function toLogin() {
      this.query('.register').style.opacity = '1';
      this.query('.back').style.opacity = '0';
      owo.go('/view-loginContent=login/moveToLeft/moveFromRight/true/moveToRight/moveFromLeft');
    },
    "toForgetPassword": function toForgetPassword() {
      this.query('.register').style.opacity = '0';
      this.query('.back').style.opacity = '1';
      owo.go('/view-loginContent=forgetPassword/moveToLeft/moveFromRight/true/moveToRight/moveFromLeft');
    },
    "forget": function forget() {
      var _this3 = this;

      if (!this.data.forgetPassWord) {
        owo.tool.toast('新密码不能为空!');
        return;
      }

      if (this.data.forgetPassWordR !== this.data.forgetPassWord) {
        owo.tool.toast('重复密码与新密码不一致!');
        return;
      }

      console.log(this.data);

      if (!this.data.phoneCode) {
        owo.tool.toast('手机验证码没有输入!');
        return;
      }

      var password = this.encry(this.data.forgetPassWordR + 'puge');
      getData("/forget?phone=" + this.data.registerPhone + "&password=" + this.data.forgetPassWord + "&code=" + this.data.phoneCode, function (data) {
        if (owo.tool.toast) owo.tool.toast('密码重置成功!');else alert('密码重置成功!');

        _this3.toLogin();
      });
    },
    "weixinLoginUrl": function weixinLoginUrl() {
      getData('getWeixinLoginUrl', function (url) {
        window.location.replace(url);
      });
    },
    "view": {
      "loginContent": [{
        "_name": "login",
        "_inherit": true
      }, {
        "_name": "forgetPassword",
        "_inherit": true
      }, {
        "_name": "register",
        "_inherit": true
      }]
    }
  },
  "page": {
    "view": {
      "content": [{
        "data": {
          "info": []
        },
        "created": function created() {
          var _this4 = this;

          setTimeout(function () {
            getData('adminGetRoom', function (data) {
              console.log(data);
              data.forEach(function (element) {
                if (userList[element.user_id]) {
                  element.userName = userList[element.user_id].username;
                } else {
                  element.userName = '已删除用户';
                }

                element.finish = element.finish == 1 ? '已结束' : '进行中';
              });
              _this4.data.info = data;

              _this4.handleEvent();
            });
          }, 1000);
        },
        "prop": {
          "route": "room"
        },
        "_name": "room"
      }]
    }
  }
};
</script>

  </body>
</html>